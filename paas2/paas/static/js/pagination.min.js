jQuery.fn.pagination=function(opt){function get_table_data(page_index,contain_obj){is_select&&($("#select_pagination").attr("class")||$("<label>"+gettext("每页显示行")+'</label><select id="select_pagination" name="items_per_page" class="span1"><option> </option><option>5</option><option>10</option><option>15</option><option>20</option><option>25</option><option>30</option></select>').insertBefore(panel));var items_per_page=parseInt($("#select_pagination").val())?parseInt($("#select_pagination").val()):opts.items_per_page?opts.items_per_page:10,max_elem=Math.min((page_index+1)*items_per_page,total_num)-1;if(!$("#loading_example")[0]&&"TBODY"==$(opts.table_obj).get(0).tagName){$(opts.table_obj).parent("table").addClass("loading_position");var cols=0;$(opts.table_obj).parent("table").find("thead tr:first th").each(function(){cols+=$(this).attr("colspan")?parseInt($(this).attr("colspan")):1}),$('<td style="padding:0" colspan="'+cols+'"><div class="loading_example opacity_7" style="top:'+$(opts.table_obj).parent("table").find("thead").height()+"px; height:"+$(opts.table_obj).height()+'px"><img class="loading_image" src="'+loading_img+'" title="'+gettext("正在努力加载数据。。。")+'" alt="'+gettext("正在努力加载数据。。。")+'"/></div></td>').appendTo($(opts.table_obj))}if(opts.async)$(".loading_example").show(),$.get(opts.url+(opts.url.indexOf("?")<0?"?page=":"page=")+page_index,function(data){var get_data=eval("("+data+")");$(opts.table_obj).html(get_data.data),total_num=get_data.total_num,extends_par=get_data.extends_par,opts.callback.call(this,extends_par),$(".loading_example").hide()});else{for(var from=(page_index-1)*items_per_page+1,to=from+items_per_page-1,rows=$(opts.table_obj).find("tr"),i=1;i<rows.length;i++)rows[i].style.display=i<from||i>to?"none":"";total_num=rows.length-1,extends_par=""}return!1}var opts=jQuery.extend({url:"",items_per_page:10,current_page:1,link_to:"###",num_display_items:4,table_obj:"",callback:function(){},is_select:!1,async:!0},opt||{}),total_num,extends_par,panel=$(this),loading_img="",is_select=opts.is_select;return this.each(function(){function num_pages(t){return Math.ceil(t/opts.items_per_page)}function get_interval(t){var e=Math.ceil(opts.num_display_items/2),a=num_pages(t),s=a-opts.num_display_items;return[opts.current_page>e?Math.max(Math.min(opts.current_page-e,s),1):1,opts.current_page>e?Math.min(opts.current_page+e,a):Math.min(opts.num_display_items,a)]}function page_selected(t,e,a){opts.current_page=t,draw_link(a);var s=get_table_data(t,panel);return s||(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0),s}function draw_link(t){$("#pagination_id").show(),$("#page_goto").show(),panel.empty();var e=get_interval(t),a=num_pages(t),s=function(e){return function(a){return page_selected(e,a,t)}},n=function(t,e){if(t=t<1?1:t<a?t:a,e=jQuery.extend({text:t,classes:""},e||{}),t==opts.current_page)var n=$("<span class='active btn'>"+e.text+"</span>");else if("disabled"!=e.classes)var n=$("<a class='btn'>"+e.text+"</a>").bind("click",s(t)).attr("href",opts.link_to.replace(/__id__/,t));else var n=$("<a class='btn'>"+e.text+"</a>");e.classes&&n.addClass(e.classes),panel.append(n)};if(opts.current_page>1?n(opts.current_page-1,{text:gettext("上一页"),classes:"prev"}):n(opts.current_page+1,{text:gettext("上一页"),classes:"disabled"}),e[1]-e[0]>4&&(e[1]=e[0]+4),e[0]>0){for(var o=Math.min(2,e[0]),p=1;p<o;p++)n(p);e[0]>2&&$("<span class='btn cursor_default'>...</span>").appendTo(panel)}for(var p=e[0];p<e[1];p++)n(p);if(e[1]<a+1){a-2>e[1]&&$("<span class='btn cursor_default'>...</span>").appendTo(panel);for(var i=Math.max(a-2,e[1]),p=i;p<a+1;p++)n(p)}opts.current_page<a?n(opts.current_page+1,{text:gettext("下一页"),classes:"next"}):n(opts.current_page+1,{text:gettext("下一页"),classes:"disabled"}),0==t&&($("#pagination_id").hide(),$("#page_goto").hide())}if(!$("#loading_example")[0]&&"TBODY"==$(opts.table_obj).get(0).tagName){var cols=0;$(opts.table_obj).parent("table").find("thead tr:first th").each(function(){cols+=$(this).attr("colspan")?parseInt($(this).attr("colspan")):1}),$('<tr><td style="height:275px; padding:0" colspan="'+cols+'"><div class="loading_position"><div class="loading_example opacity_7 hide"><img class="loading_image" src="'+loading_img+'" title="'+gettext("正在努力加载数据。。。")+'" alt="'+gettext("正在努力加载数据。。。")+'"/></div></div></td></tr>').appendTo($(opts.table_obj))}if(opts.async)$(".loading_example").show(),$.get(opts.url+(opts.url.indexOf("?")<0?"?page=":"page=")+opts.current_page,function(data){var get_data=eval("("+data+")");$(opts.table_obj).html(get_data.data),total_num=get_data.total_num,extends_par=get_data.extends_par,total_num>=0&&draw_link(total_num),opts.callback.call(this,extends_par),$(".loading_example").hide()});else{for(var from=(opts.current_page-1)*opts.items_per_page+1,to=from+opts.items_per_page-1,rows=$(opts.table_obj).find("tr"),i=1;i<rows.length;i++)rows[i].style.display=i<from||i>to?"none":"";total_num=rows.length-1,extends_par="",total_num>=0&&draw_link(total_num)}})};